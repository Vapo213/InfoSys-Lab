DROP TABLE AMT;
ECHO '------------------------------';
DROP TABLE DEPUTAT;
ECHO '------------------------------';
DROP TABLE DOZENT;
ECHO '------------------------------';
DROP TABLE FAKULTAET;
ECHO '------------------------------';
DROP TABLE LEHRBEAUFTRAGTER;
ECHO '------------------------------';
DROP TABLE MODUL;
ECHO '------------------------------';
DROP TABLE PROFESSOR;
ECHO '------------------------------';
DROP TABLE STUDIENGANG;
ECHO '------------------------------';
DROP TABLE STUPO;
ECHO '------------------------------';
DROP TABLE STUPO_MODUL;
ECHO '------------------------------';
DROP TABLE SUBGRUPPE;
ECHO '------------------------------';
DROP TABLE VERANSTALTUNG;
ECHO '------------------------------';
DROP TABLE ZEITSEMESTER;
ECHO '------------------------------';




DROP TABLE ZUORDNUNG_VERANSTALTUNG_DOZENT;

CREATE TABLE AMT
	( AMT_ID int NOT NULL
	, AMT_BEZEICHNUNG varchar(50) NOT NULL
	, AMT_DWS int NOT NULL
	, DOZENT_ID int NOT NULL
	, ZEITSEMESTER_ID int NOT NULL )
;

CREATE TABLE DEPUTAT
	( DEPUTAT_ID int NOT NULL GENERATED ALWAYS AS IDENTITY  (START WITH 1, INCREMENT BY 1)
	, DEPUTAT_DWS int NOT NULL
	, DOZENT_ID int NOT NULL
	, ZEITSEMESTER_ID int NOT NULL )
;

CREATE TABLE DOZENT
	( DOZENT_ID int NOT NULL
	, NACHNAME varchar(50) NOT NULL
	, VORNAME varchar(50)
	, FAKULTAET_ID int NOT NULL )
;

CREATE TABLE FAKULTAET
	( FAKULTAET_ID int NOT NULL GENERATED ALWAYS AS IDENTITY  (START WITH 1, INCREMENT BY 1)
	, FAKULTAET_BEZEICHNUNG varchar(50) NOT NULL )
;

CREATE TABLE LEHRBEAUFTRAGTER
	( STRASSE varchar(50) NOT NULL
	, HAUSNUMMER int NOT NULL
	, PLZ int NOT NULL
	, WOHNORT varchar(50) NOT NULL
	, DOZENT_ID int NOT NULL )
;

CREATE TABLE MODUL
	( MODUL_ID int NOT NULL 
	, WAHLMODUL char(1) NOT NULL
	, MODUL_BEZEICHNUNG varchar(50) NOT NULL
	, VORGESCHRIEBENE_DWS int NOT NULL
	, VORGESCHRIEBENE_SWS int NOT NULL )
;

CREATE TABLE PROFESSOR
	( MINIMUN_DWS int NOT NULL
	, DOZENT_ID int NOT NULL )
;

CREATE TABLE STUDIENGANG
	( STUDIENGANG_ID int NOT NULL GENERATED ALWAYS AS IDENTITY  (START WITH 1, INCREMENT BY 1)
	, STUDIENGANG_BEZEICHNUNG varchar(50) NOT NULL
	, FAKULTAET_ID int NOT NULL )
;

CREATE TABLE STUPO
	( STUPO_ID int NOT NULL
	, ERSCHEINUNG_DATUM date NOT NULL
	, AENDERUNG_DATUM date NOT NULL
	, STUDIENGANG_ID int NOT NULL )
;

CREATE TABLE STUPO_MODUL
	( STUPO_ID int NOT NULL
	, MODUL_ID int NOT NULL )
;

CREATE TABLE SUBGRUPPE
	( SUBGRUPPE_ID int NOT NULL
	, SUBGRUPPE_BEZEICHNUNG varchar(50) NOT NULL
	, VERANSTALTUNG_ID int NOT NULL )
;

CREATE TABLE VERANSTALTUNG
	( VERANSTALTUNG_ID int NOT NULL GENERATED ALWAYS AS IDENTITY  (START WITH 1, INCREMENT BY 1)
	, VERANSTALTUNG_BEZEICHNUNG varchar(50) NOT NULL
	, DWS int NOT NULL
	, SWS int NOT NULL
	, TYP varchar(50) NOT NULL
	, MODUL_ID int NOT NULL )
;


CREATE TABLE ZEITSEMESTER
	( ZEITSEMESTER_ID int NOT NULL
	, ZEITSEMESTER_BEZEICHNUNG varchar(50) NOT NULL
	, ZEITSEMESTER_START date NOT NULL
	, ZEITSEMESTER_ENDE date NOT NULL )
;

CREATE TABLE ZUORDNUNG_VERANSTALTUNG_DOZENT
	( ZUORDNUNG_VERANSTALTUNG_DOZENT_ID int NOT NULL GENERATED ALWAYS AS IDENTITY  (START WITH 1, INCREMENT BY 1)
	, VERANSTALTUNG_DWS int NOT NULL
	, VERANSTALTUNG_ID int NOT NULL
	, DOZENT_ID int NOT NULL
	, ZEITSEMESTER_ID int NOT NULL )
;



ALTER TABLE AMT
	ADD CONSTRAINT PK PRIMARY KEY 
	( AMT_ID );

ALTER TABLE DEPUTAT
	ADD CONSTRAINT PK PRIMARY KEY 
	( DEPUTAT_ID );

ALTER TABLE DOZENT
	ADD CONSTRAINT PK PRIMARY KEY 
	( DOZENT_ID );

ALTER TABLE FAKULTAET
	ADD CONSTRAINT PK PRIMARY KEY 
	( FAKULTAET_ID );

ALTER TABLE LEHRBEAUFTRAGTER
	ADD CONSTRAINT PK PRIMARY KEY 
	( DOZENT_ID );

ALTER TABLE MODUL
	ADD CONSTRAINT PK PRIMARY KEY 
	( MODUL_ID );

ALTER TABLE PROFESSOR
	ADD CONSTRAINT PK PRIMARY KEY 
	( DOZENT_ID );

ALTER TABLE STUDIENGANG
	ADD CONSTRAINT PK PRIMARY KEY 
	( STUDIENGANG_ID );

ALTER TABLE STUPO
	ADD CONSTRAINT PK PRIMARY KEY 
	( STUPO_ID );

ALTER TABLE STUPO_MODUL
	ADD CONSTRAINT PK PRIMARY KEY 
	( STUPO_ID
	, MODUL_ID );

ALTER TABLE SUBGRUPPE
	ADD CONSTRAINT PK PRIMARY KEY 
	( SUBGRUPPE_ID );

ALTER TABLE VERANSTALTUNG
	ADD CONSTRAINT PK PRIMARY KEY 
	( VERANSTALTUNG_ID );

ALTER TABLE ZEITSEMESTER
	ADD CONSTRAINT PK PRIMARY KEY 
	( ZEITSEMESTER_ID );

ALTER TABLE ZUORDNUNG_VERANSTALTUNG_DOZENT
	ADD CONSTRAINT PK PRIMARY KEY 
	( ZUORDNUNG_VERANSTALTUNG_DOZENT_ID );



ALTER TABLE AMT
	ADD CONSTRAINT AMT_PROFESSOR FOREIGN KEY
	( DOZENT_ID )
	REFERENCES PROFESSOR
	( DOZENT_ID ); 

ALTER TABLE AMT
	ADD CONSTRAINT AMT_ZEITSEMESTER FOREIGN KEY
	( ZEITSEMESTER_ID )
	REFERENCES ZEITSEMESTER
	( ZEITSEMESTER_ID ); 

ALTER TABLE DEPUTAT
	ADD CONSTRAINT DEPUTAT_PROFESSOR FOREIGN KEY
	( DOZENT_ID )
	REFERENCES PROFESSOR
	( DOZENT_ID ); 

ALTER TABLE DEPUTAT
	ADD CONSTRAINT DEPUTAT_ZEITSEMESTER FOREIGN KEY
	( ZEITSEMESTER_ID )
	REFERENCES ZEITSEMESTER
	( ZEITSEMESTER_ID ); 

ALTER TABLE DOZENT
	ADD CONSTRAINT DOZENT_FAKULTAET FOREIGN KEY
	( FAKULTAET_ID )
	REFERENCES FAKULTAET
	( FAKULTAET_ID ); 

ALTER TABLE LEHRBEAUFTRAGTER
	ADD CONSTRAINT LEHRBEAUFTRAGTER_DOZENT FOREIGN KEY
	( DOZENT_ID )
	REFERENCES DOZENT
	( DOZENT_ID )
	ON DELETE CASCADE; 

ALTER TABLE PROFESSOR
	ADD CONSTRAINT PROFESSOR_DOZENT FOREIGN KEY
	( DOZENT_ID )
	REFERENCES DOZENT
	( DOZENT_ID )
	ON DELETE CASCADE; 

ALTER TABLE STUDIENGANG
	ADD CONSTRAINT STUDIENGANG_FAKULTAET FOREIGN KEY
	( FAKULTAET_ID )
	REFERENCES FAKULTAET
	( FAKULTAET_ID ); 

ALTER TABLE STUPO
	ADD CONSTRAINT STUPO_STUDIENGANG FOREIGN KEY
	( STUDIENGANG_ID )
	REFERENCES STUDIENGANG
	( STUDIENGANG_ID ); 

ALTER TABLE STUPO_MODUL
	ADD CONSTRAINT STUPO_MODUL_STUPO FOREIGN KEY
	( STUPO_ID )
	REFERENCES STUPO
	( STUPO_ID )
	ON DELETE CASCADE; 

ALTER TABLE STUPO_MODUL
	ADD CONSTRAINT STUPO_MODUL_MODUL FOREIGN KEY
	( MODUL_ID )
	REFERENCES MODUL
	( MODUL_ID )
	ON DELETE CASCADE; 

ALTER TABLE SUBGRUPPE
	ADD CONSTRAINT SUBGRUPPE_VERANSTALTUNG FOREIGN KEY
	( VERANSTALTUNG_ID )
	REFERENCES VERANSTALTUNG
	( VERANSTALTUNG_ID ); 

ALTER TABLE VERANSTALTUNG
	ADD CONSTRAINT MODUL_ID FOREIGN KEY
	( MODUL_ID )
	REFERENCES MODUL
	( MODUL_ID ); 

ALTER TABLE ZUORDNUNG_VERANSTALTUNG_DOZENT
	ADD CONSTRAINT ZUORDNUNG_VERANSTALTUNG_DOZENT_VERANSTALTUNG FOREIGN KEY
	( VERANSTALTUNG_ID )
	REFERENCES VERANSTALTUNG
	( VERANSTALTUNG_ID ); 

ALTER TABLE ZUORDNUNG_VERANSTALTUNG_DOZENT
	ADD CONSTRAINT ZUORDNUNG_VERANSTALTUNG_DOZENT_DOZENT FOREIGN KEY
	( DOZENT_ID )
	REFERENCES DOZENT
	( DOZENT_ID ); 

ALTER TABLE ZUORDNUNG_VERANSTALTUNG_DOZENT
	ADD CONSTRAINT ZUORDNUNG_VERANSTALTUNG_DOZENT_ZEITSEMESTER FOREIGN KEY
	( ZEITSEMESTER_ID )
	REFERENCES ZEITSEMESTER
	( ZEITSEMESTER_ID );


ALTER TABLE VERANSTALTUNG ADD
   CONSTRAINT checkConstraint CHECK (TYP IN ('L','V') );


